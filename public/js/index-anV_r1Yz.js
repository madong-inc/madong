var G=Object.defineProperty,L=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var D=(a,n,t)=>n in a?G(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,b=(a,n)=>{for(var t in n||(n={}))j.call(n,t)&&D(a,t,n[t]);if(S)for(var t of S(n))q.call(n,t)&&D(a,t,n[t]);return a},y=(a,n)=>L(a,N(n));var T=(a,n,t)=>new Promise((k,u)=>{var c=r=>{try{m(t.next(r))}catch(h){u(h)}},f=r=>{try{m(t.throw(r))}catch(h){u(h)}},m=r=>r.done?k(r.value):Promise.resolve(r.value).then(c,f);m((t=t.apply(a,n)).next())});import"./form-CnpKYFzH.js";import"./vxe-table-DN_3U_z_.js";import{r as E,p as K,l as Z,e as H,f as J,h as M}from"./user-Cu6cmzRD.js";import{_ as A}from"./table-action.vue_vue_type_script_setup_true_lang-Bo6k7XMX.js";import Q from"./detail-DXfg9jNw.js";import W from"./form-BEpMoNOb.js";import{_ as X}from"./grant-role.vue_vue_type_script_setup_true_lang-BsXlts8w.js";import{g as F,s as Y}from"./index-s-IQaRr9.js";import{at as ee,B as se,a3 as te}from"./bootstrap-DBsnWor2.js";import{_ as oe}from"./page.vue_vue_type_script_setup_true_lang-9XYPEXDE.js";import{h as ne,bP as ae,bO as ie,b as _,j as le,n as re,k as p,z as d,u as l,Z as de,cK as g}from"../jse/index-index-BUCZBWdu.js";import{u as ue}from"./use-vxe-grid-CxZE6Hzc.js";import{u as ce}from"./use-tabs-3uQ27r_x.js";import"./component-map-Dg1YW3q5.js";import"./index-1NUgD4WV.js";import"./Dropdown-G0jIiXp0.js";import"./description.vue_vue_type_script_setup_true_lang-CrOvFWHr.js";import"./index-BWzmO9nj.js";import"./use-modal-BGLiGhJB.js";import"./x-BAo__qRZ.js";import"./loading-BKAGElNW.js";const $e=ne({__name:"index",setup(a){const{hasAccessByCodes:n}=ee(),t=ae(),k=ie(),u=_(!1),c=_(),f=_(),m=_(),r=y(b({},Y),{collapsed:!0}),h=y(b({},F),{toolbarConfig:y(b({},F.toolbarConfig),{slots:{buttons:"toolbar-buttons"},custom:{icon:"vxe-icon-menu"}}),height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(o,x)=>T(this,[o,x],function*({page:e},s){return yield M(b({page:e.currentPage,limit:e.pageSize},s))})}}}),U={checkboxChange(){const e=i.grid.getCheckboxRecords();u.value=e.length>0},checkboxAll(){const e=i.grid.getCheckboxRecords();u.value=e.length>0}},[B,i]=ue({formOptions:r,gridOptions:h,gridEvents:U}),O=()=>{c.value.setData({isUpdate:!1,gridApi:i}),c.value.open()},P=e=>{c.value.setData({record:e,isUpdate:!0,gridApi:i}),c.value.open()},$=e=>{f.value.setData({record:e}),f.value.open()},w=e=>{m.value.setData({record:e,gridApi:i}),m.value.open()},C=e=>{let s=[];e?s.push(e.id):s=i.grid.getCheckboxRecords().map(o=>o.id),E({ids:s}).then(()=>{g.success("重置密码成功"),i.reload()})},z=e=>{K({userId:e.id}).then(s=>{k.setAccessToken(s.token),k.setRefreshToken(s.refreshToken),g.success("用户扮演成功！");const{closeCurrentTab:o}=ce();o(),setTimeout(()=>{location.reload()},600)})},I=e=>{const s=[];e&&e.id&&s.push(e.id),Z({data:s}).then(()=>{g.success("锁定用户成功"),i.reload()})},V=e=>{const s=[];e&&e.id&&s.push(e.id),H({data:s}).then(()=>{g.success("取消锁定用户成功"),i.reload()})},v=e=>{let s=[];e?s.push(e.id):s=i.grid.getCheckboxRecords().map(o=>o.id),J(0,{data:s}).then(()=>{g.success("删除成功"),i.reload()})};return(e,s)=>(re(),le(l(oe),{"auto-content-height":""},{default:p(()=>[d(l(B),null,{"toolbar-buttons":p(()=>[d(l(A),{actions:[{label:"新增",type:"primary",icon:"ant-design:plus-outlined",auth:["admin","system:user:save"],onClick:O.bind(null)}],"drop-down-actions":[{label:"重置密码",icon:"ant-design:setting-outlined",ifShow:u.value,auth:["admin","system:user:reset_password"],popConfirm:{title:"是否重置该用户密码？",confirm:C.bind(null)}},{label:"删除",icon:"ant-design:delete-outlined",ifShow:u.value,auth:["admin","system:user:remove"],popConfirm:{title:"确定删除吗？",confirm:v.bind(null,!1)}}]},{more:p(()=>[d(l(se),{style:{"margin-left":"8px"}},{default:p(()=>[s[0]||(s[0]=de(" 批量操作 ")),d(l(te))]),_:1})]),_:1},8,["actions","drop-down-actions"])]),"toolbar-tools":p(()=>s[1]||(s[1]=[])),ACTION:p(({row:o})=>{var x,R;return[d(l(A),{actions:[{label:"详情",type:"link",size:"small",auth:["admin","system:user:detail"],onClick:$.bind(null,o)},{label:"编辑",type:"link",size:"small",auth:["admin","system:user:update"],onClick:P.bind(null,o)}],"drop-down-actions":[{label:"扮演用户",icon:"ant-design:play-square-outlined",auth:["admin","system:play_user"],ifShow:!1,popConfirm:{title:"是否扮演该用户？",confirm:z.bind(null,o)}},{label:"重置密码",icon:"ant-design:setting-outlined",auth:["admin","system:user:reset_password"],popConfirm:{title:"是否重置该用户密码？",confirm:C.bind(null,o)}},{label:"授权角色",icon:"ant-design:usergroup-add-outlined",auth:["admin","system:user:grant_role"],onClick:w.bind(null,o)},{label:"冻结用户",icon:"ant-design:lock-outlined",auth:["admin","system:user:locked"],popConfirm:{title:"是否冻结该用户？",confirm:I.bind(null,o)},ifShow(){return l(n)(["admin","system:user:locked"])&&o.is_locked===0},disabled:((x=l(t).$state.userInfo)==null?void 0:x.id)===o.id},{label:"取消冻结",icon:"ant-design:unlock-outlined",auth:["admin","system:user:un_locked"],popConfirm:{title:"是否取消冻结该用户？",confirm:V.bind(null,o)},ifShow(){return l(n)(["admin","system:user:un_locked"])&&o.is_locked===1},disabled:((R=l(t).$state.userInfo)==null?void 0:R.id)===o.id},{label:"删除",icon:"ant-design:delete-outlined",auth:["admin","system:user:remove"],popConfirm:{title:"确定删除吗？",confirm:v.bind(null,o)}}]},null,8,["actions","drop-down-actions"])]}),_:1}),d(W,{ref_key:"userFormRef",ref:c},null,512),d(Q,{ref_key:"detailFormRef",ref:f},null,512),d(X,{ref_key:"grantRoleRef",ref:m},null,512)]),_:1}))}});export{$e as default};
