var x=Object.defineProperty;var C=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var y=(e,t,l)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,I=(e,t)=>{for(var l in t||(t={}))v.call(t,l)&&y(e,l,t[l]);if(C)for(var l of C(t))k.call(t,l)&&y(e,l,t[l]);return e};var N=(e,t,l)=>new Promise((r,d)=>{var h=o=>{try{p(l.next(o))}catch(a){d(a)}},i=o=>{try{p(l.throw(o))}catch(a){d(a)}},p=o=>o.done?r(o.value):Promise.resolve(o.value).then(h,i);p((l=l.apply(e,t)).next())});import{u as P}from"./form-CnpKYFzH.js";import"./vxe-table-DN_3U_z_.js";import{bN as n,h as S,b as _,u as g,cK as A,j as D,n as F,k as V,a6 as T,z as $}from"../jse/index-index-BUCZBWdu.js";import{u as R}from"./use-modal-BGLiGhJB.js";import{aK as q}from"./bootstrap-DBsnWor2.js";const s="/monitor/crontab",J=e=>n.get(s,{params:e}),W=e=>n.get(`${s}/${e}`),B=e=>n.post(s,e),z=(e,t)=>n.put(`${s}/${e}`,t),X=(e,t)=>n.delete(`${s}/${e}`,{data:t}),Y=e=>n.post(`${s}/resume`,e),Z=e=>n.post(`${s}/pause`,e),ee=e=>n.post(`${s}/execute`,e),le={toolbarConfig:{refresh:!0,print:!1,export:!1,zoom:!0},columnConfig:{resizable:!0},columns:[{type:"checkbox",width:60},{field:"title",title:"任务名称",align:"left"},{field:"rule",title:"执行表达式",align:"left"},{field:"enabled",title:"是否启用",cellRender:{name:"ApiDict",props:{code:"yes_no"}}},{field:"singleton",title:"模式",cellRender:{name:"ApiDict",props:{code:"monitor_crontab_mode"}}},{field:"rule_name",align:"left",title:"执行周期"},{field:"target",title:"调用目标",align:"left",minWidth:170},{field:"running_times",title:"运行次数",align:"left"},{field:"last_running_time",title:"上次运行时间",width:170},{width:200,title:"操作",align:"center",slots:{default:"ACTION"},fixed:"right"}]},te={schema:[{component:"Input",fieldName:"LIKE_title",label:"任务名称",componentProps:{placeholder:"请输入任务名称",allowClear:!0}},{component:"ApiDict",fieldName:"IN_singleton",label:"模式",componentProps:{placeholder:"请选择",allowClear:!0,code:"monitor_crontab_mode",renderType:"Select"}},{component:"ApiDict",fieldName:"EQ_enabled",label:"是否启用",componentProps:{placeholder:"请选择",allowClear:!0,code:"yes_no",renderType:"Select"}}]},j={wrapperClass:"grid-cols-12",commonConfig:{formItemClass:"col-span-12"},schema:[{fieldName:"id",label:"任务ID",component:"Input",ifDetail:!1,dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"title",label:"任务名称",component:"Input",componentProps:{placeholder:"请输入定时任务名称",allowClear:!0},formItemClass:"col-span-12",rules:"required",detailSpan:12},{fieldName:"type",label:"任务类型",component:"ApiDict",defaultValue:1,componentProps:{placeholder:"请选择是否启用",code:"monitor_crontab_type",isBtn:!0,renderType:"Select"},formItemClass:"col-span-12",detailSpan:6,rules:"selectRequired"},{fieldName:"rule",label:"表达式",component:"Input",componentProps:{placeholder:"请输入定时任务名称",allowClear:!0},dependencies:{triggerFields:["id"],show:e=>e.id!==void 0&&e.id!==""&&e.id!==null,disabled:e=>e.id!==void 0&&e.id!==""&&e.id!==null},formItemClass:"col-span-12",detailSpan:12},{fieldName:"task_cycle",label:"执行周期",component:"ApiDict",defaultValue:"",componentProps:{placeholder:"请选择",code:"monitor_crontab_cycle",renderType:"Select"},formItemClass:"col-span-4",rules:"selectRequired"},{fieldName:"month",label:"",labelWidth:0,suffix:()=>"月",component:"InputNumber",formItemClass:"col-span-2",dependencies:{triggerFields:["task_cycle"],show:e=>[8].includes(e.task_cycle)},componentProps:{min:1,max:12}},{fieldName:"day",label:"",labelWidth:0,suffix:()=>"日",component:"InputNumber",formItemClass:"col-span-2",dependencies:{triggerFields:["task_cycle"],show:e=>[7,8].includes(e.task_cycle)},componentProps:{min:1,max:31}},{fieldName:"week",label:"",labelWidth:1,component:"Select",dependencies:{triggerFields:["task_cycle"],show:e=>[6].includes(e.task_cycle)},componentProps:{allowClear:!0,filterOption:!0,options:[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:0}],placeholder:"",showSearch:!0},formItemClass:"col-span-2"},{fieldName:"hour",label:"",labelWidth:0,suffix:()=>"时",component:"InputNumber",formItemClass:"col-span-2",dependencies:{triggerFields:["task_cycle"],show:e=>[1,3,6,7,8].includes(e.task_cycle)},componentProps:{min:1,max:23}},{fieldName:"minute",label:"",labelWidth:0,suffix:()=>"分",component:"InputNumber",formItemClass:"col-span-2",dependencies:{triggerFields:["task_cycle"],show:e=>[1,2,3,4,6,7,8].includes(e.task_cycle)},componentProps:{min:0,max:59}},{fieldName:"second",label:"",labelWidth:0,suffix:()=>"秒",component:"InputNumber",formItemClass:"col-span-2",dependencies:{triggerFields:["task_cycle"],show:e=>[5].includes(e.task_cycle)},componentProps:{min:0,max:59}},{fieldName:"target",label:"调用目标",component:"Textarea",componentProps:{placeholder:"请输入调用目标",allowClear:!0},formItemClass:"col-span-12",detailSpan:12,rules:"required"},{fieldName:"singleton",label:"执行周期",component:"ApiDict",defaultValue:1,componentProps:{placeholder:"请选择",code:"monitor_crontab_mode",renderType:"RadioGroup"},formItemClass:"col-span-12",rules:"selectRequired"},{fieldName:"enabled",label:"启用状态",component:"ApiDict",defaultValue:1,componentProps:{placeholder:"请选择",code:"yes_no",isBtn:!0,renderType:"RadioGroup"},formItemClass:"col-span-12",rules:"selectRequired"},{fieldName:"remark",label:"备注",component:"Textarea",componentProps:{placeholder:"请输入备注"},formItemClass:"col-span-12",detailSpan:12}]},K={class:"common-form"},L=S({__name:"form",setup(e,{expose:t}){const l=_(),r=_(!1),d=_(),[h,i]=P(I({showDefaultActions:!1},j)),[p,o]=R({draggable:!0,onOpenChange(a){var c,m,f,b,u;r.value=(m=(c=o.getData())==null?void 0:c.isUpdate)!=null?m:!1,l.value=a?((f=o.getData())==null?void 0:f.record)||{}:{},d.value=a?(b=o.getData())==null?void 0:b.gridApi:null,a&&l.value.id?W((u=l.value)==null?void 0:u.id).then(w=>{i.setValues(w)}):i.setValues(l.value)},onConfirm(){i.validate().then(a=>N(this,null,function*(){var c;if(a.valid){const m=yield i.getValues();o.setState({loading:!0,confirmLoading:!0});const f=g(r)?z:B,b=g(r)?[(c=l.value)==null?void 0:c.id,m]:[m];f(...b).then(()=>{var u;A.success("保存成功"),(u=d.value)==null||u.reload(),o.close()}).finally(()=>{o.setState({loading:!1,confirmLoading:!1})})}}))}});return t(o),(a,c)=>(F(),D(g(p),{title:r.value?"编辑任务":"新增任务",class:"w-[50%]"},{default:V(()=>[T("div",K,[$(g(h))])]),_:1},8,["title"]))}}),M=q(L,[["__scopeId","data-v-90cf7fc6"]]),oe=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{M as C,X as d,ee as e,oe as f,le as g,J as l,Z as p,Y as r,te as s};
