var f=(p,m,l)=>new Promise((r,u)=>{var a=o=>{try{t(l.next(o))}catch(d){u(d)}},n=o=>{try{t(l.throw(o))}catch(d){u(d)}},t=o=>o.done?r(o.value):Promise.resolve(o.value).then(a,n);t((l=l.apply(p,m)).next())});import{h as N,cr as B,r as L,c as v,V as k,n as y,z as h,k as g,l as T,Z as b,_,u as c,c9 as e,a6 as V,c0 as $,b as x,cU as E,cK as P,cE as A}from"../jse/index-index-BUCZBWdu.js";import{u as F,T as D,a as w,s as C}from"./bootstrap-DBsnWor2.js";const q={class:"text-muted-foreground"},z=N({name:"AuthenticationCodeLogin",__name:"code-login",props:{formSchema:{},loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(p,{expose:m,emit:l}){const r=p,u=l,a=B(),[n,t]=F(L({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:v(()=>r.formSchema),showDefaultActions:!1}));function o(){return f(this,null,function*(){const{valid:s}=yield t.validate(),i=yield t.getValues();s&&u("submit",{code:i==null?void 0:i.code,phoneNumber:i==null?void 0:i.phoneNumber})})}function d(){a.push(r.loginPath)}return m({getFormApi:()=>t}),(s,i)=>(y(),k("div",null,[h(D,null,{desc:g(()=>[V("span",q,[T(s.$slots,"subTitle",{},()=>[b(_(s.subTitle||c(e)("authentication.codeSubtitle")),1)])])]),default:g(()=>[T(s.$slots,"title",{},()=>[b(_(s.title||c(e)("authentication.welcomeBack"))+" 📲 ",1)])]),_:3}),h(c(n)),h(c(w),{class:$([{"cursor-wait":s.loading},"w-full"]),loading:s.loading,onClick:o},{default:g(()=>[T(s.$slots,"submitButtonText",{},()=>[b(_(s.submitButtonText||c(e)("common.login")),1)])]),_:3},8,["class","loading"]),h(c(w),{class:"mt-4 w-full",variant:"outline",onClick:i[0]||(i[0]=I=>d())},{default:g(()=>[b(_(c(e)("common.back")),1)]),_:1})]))}}),S=6,K=N({name:"CodeLogin",__name:"code-login",setup(p){const m=x(!1),l=v(()=>[{component:"VbenInput",componentProps:{placeholder:e("authentication.mobile")},fieldName:"phoneNumber",label:e("authentication.mobile"),rules:C().min(1,{message:e("authentication.mobileTip")}).refine(a=>/^\d{11}$/.test(a),{message:e("authentication.mobileErrortip")})},{component:"VbenPinInput",componentProps(a,n){return{createText:t=>t>0?e("authentication.sendText",[t]):e("authentication.sendCode"),codeLength:6,placeholder:e("authentication.code"),handleSendCode:()=>f(this,null,function*(){const{valid:t,value:o}=yield n.validateField("phoneNumber");if(!t)throw new Error("未填写手机号");yield E({mobile_phone:o}),P.success("验证码发送成功")})}},fieldName:"code",label:e("authentication.code"),rules:C().length(S,{message:e("authentication.codeTip",[S])})}]),r=A();function u(a){return f(this,null,function*(){try{const n={mobile_phone:a.phoneNumber,code:a.code,grant_type:"sms"};yield r.authLogin(n)}catch(n){console.error(n)}})}return(a,n)=>(y(),k("div",null,[h(c(z),{"form-schema":l.value,loading:m.value,onSubmit:u},null,8,["form-schema","loading"])]))}});export{K as default};
