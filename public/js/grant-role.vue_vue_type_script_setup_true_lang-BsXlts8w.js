var b=Object.defineProperty;var u=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var f=(t,a,e)=>a in t?b(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,g=(t,a)=>{for(var e in a||(a={}))A.call(a,e)&&f(t,e,a[e]);if(u)for(var e of u(a))C.call(a,e)&&f(t,e,a[e]);return t};var _=(t,a,e)=>new Promise((n,i)=>{var m=o=>{try{r(e.next(o))}catch(s){i(s)}},l=o=>{try{r(e.throw(o))}catch(s){i(s)}},r=o=>o.done?n(o.value):Promise.resolve(o.value).then(m,l);r((e=e.apply(t,a)).next())});import{u as D}from"./form-CnpKYFzH.js";import"./vxe-table-DN_3U_z_.js";import{g as I}from"./user-Cu6cmzRD.js";import{h as S,b as h,cK as V,j as x,n as k,u as v,k as y,z as F}from"../jse/index-index-BUCZBWdu.js";import{u as N}from"./use-modal-BGLiGhJB.js";const z=S({__name:"grant-role",setup(t,{expose:a}){const e=h(),n=h(),i={schema:[{fieldName:"user_id",label:"用户ID",component:"Input",ifDetail:!1,dependencies:{show:!1,triggerFields:["userId"]}},{fieldName:"role_id_list",label:"选择角色",component:"ApiSelect",componentProps:{placeholder:"请选择角色",allowClear:!0,api:"/system/role",mode:"multiple",params:{format:"select",enabled:1,page:1,limit:1e3}},formItemClass:"col-span-12"}]},[m,l]=D(g({showDefaultActions:!1},i)),[r,o]=N({onOpenChange(s){var d,p;e.value=s?(d=o.getData())==null?void 0:d.record:{},n.value=s?(p=o.getData())==null?void 0:p.gridApi:null;const c=[...new Set(e.value.roles.map(w=>w.id))];l.setValues({user_id:e.value.id,role_id_list:c||[]})},onConfirm(){l.validate().then(s=>_(this,null,function*(){if(s.valid){const c=yield l.getValues();o.setState({loading:!0,confirmLoading:!0}),I(c).then(()=>{V.success("保存成功"),n.value.reload(),o.close()}).finally(()=>{o.setState({loading:!1,confirmLoading:!1})})}}))}});return a(o),(s,c)=>(k(),x(v(r),{class:"w-[60%]",title:"授权角色"},{default:y(()=>[F(v(m))]),_:1}))}});export{z as _};
