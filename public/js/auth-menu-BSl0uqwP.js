import{l as me}from"./menu-C7Vk5aXg.js";import{a as pe,r as ke}from"./rbac-DZTRpzt1.js";import{z as x,h as te,aJ as ce,b as g,c as T,K as Ke,ad as N,am as Q,ai as B,al as re,aU as H,af as ae,av as D,aZ as xe,bd as R,aW as Y,w as Z,ab as be,W as ue,cK as ge,V as Ee,n as Te,k as w,u as C,Z as L,aH as Ce,a6 as le}from"../jse/index-index-BUCZBWdu.js";import{b7 as Ne,t as ee,b8 as Se,V as fe,b9 as Ie,ba as De,X as we,W as Ae,bb as Oe,bc as _e,bd as Pe,be as se,bf as $e,bg as Me,bh as Fe,bi as Le,bj as je,bk as Re,bl as Ue,av as We,M as Be,N as U,aK as Ve}from"./bootstrap-DBsnWor2.js";import{D as He}from"./index-1NUgD4WV.js";import{u as Xe}from"./use-drawer-JrzCmswA.js";import"./Dropdown-G0jIiXp0.js";import"./x-BAo__qRZ.js";import"./loading-BKAGElNW.js";var Ze=/\s/;function ze(e){for(var d=e.length;d--&&Ze.test(e.charAt(d)););return d}var Je=/^\s+/;function qe(e){return e&&e.slice(0,ze(e)+1).replace(Je,"")}var oe=NaN,Ge=/^[-+]0x[0-9a-f]+$/i,Qe=/^0b[01]+$/i,Ye=/^0o[0-7]+$/i,et=parseInt;function de(e){if(typeof e=="number")return e;if(Ne(e))return oe;if(ee(e)){var d=typeof e.valueOf=="function"?e.valueOf():e;e=ee(d)?d+"":d}if(typeof e!="string")return e===0?e:+e;e=qe(e);var i=Qe.test(e);return i||Ye.test(e)?et(e.slice(2),i?2:8):Ge.test(e)?oe:+e}var z=function(){return Se.Date.now()},tt="Expected a function",nt=Math.max,at=Math.min;function lt(e,d,i){var s,l,m,c,o,p,v=0,b=!1,r=!1,F=!0;if(typeof e!="function")throw new TypeError(tt);d=de(d)||0,ee(i)&&(b=!0,r="maxWait"in i,m=r?nt(de(i.maxWait)||0,d):m,F="trailing"in i?!!i.trailing:F);function A(h){var K=s,P=l;return s=l=void 0,v=h,c=e.apply(P,K),c}function _(h){return v=h,o=setTimeout(k,d),b?A(h):c}function O(h){var K=h-p,P=h-v,t=d-K;return r?at(t,m-P):t}function n(h){var K=h-p,P=h-v;return p===void 0||K>=d||K<0||r&&P>=m}function k(){var h=z();if(n(h))return M(h);o=setTimeout(k,O(h))}function M(h){return o=void 0,F&&s?A(h):(s=l=void 0,c)}function u(){o!==void 0&&clearTimeout(o),v=0,s=p=l=o=void 0}function a(){return o===void 0?c:M(z())}function y(){var h=z(),K=n(h);if(s=arguments,l=this,p=h,K){if(o===void 0)return _(p);if(r)return clearTimeout(o),o=setTimeout(k,d),A(p)}return o===void 0&&(o=setTimeout(k,d)),c}return y.cancel=u,y.flush=a,y}const ie=4;function st(e){const{dropPosition:d,dropLevelOffset:i,prefixCls:s,indent:l,direction:m="ltr"}=e,c=m==="ltr"?"left":"right",o=m==="ltr"?"right":"left",p={[c]:`${-i*l+ie}px`,[o]:0};switch(d){case-1:p.top="-3px";break;case 1:p.bottom="-3px";break;default:p.bottom="-3px",p[c]=`${l+ie}px`;break}return x("div",{style:p,class:`${s}-drop-indicator`},null)}const ve=()=>{const e=Pe();return N(N({},e),{showLine:Y([Boolean,Object]),multiple:D(),autoExpandParent:D(),checkStrictly:D(),checkable:D(),disabled:D(),defaultExpandAll:D(),defaultExpandParent:D(),defaultExpandedKeys:R(),expandedKeys:R(),checkedKeys:Y([Array,Object]),defaultCheckedKeys:R(),selectedKeys:R(),defaultSelectedKeys:R(),selectable:D(),loadedKeys:R(),draggable:D(),showIcon:D(),icon:H(),switcherIcon:ae.any,prefixCls:String,replaceFields:xe(),blockNode:D(),openAnimation:ae.any,onDoubleclick:e.onDblclick,"onUpdate:selectedKeys":H(),"onUpdate:checkedKeys":H(),"onUpdate:expandedKeys":H()})},X=te({compatConfig:{MODE:3},name:"ATree",inheritAttrs:!1,props:fe(ve(),{checkable:!1,selectable:!0,showIcon:!1,blockNode:!1}),slots:Object,setup(e,d){let{attrs:i,expose:s,emit:l,slots:m}=d;Ie(!(e.treeData===void 0&&m.default));const{prefixCls:c,direction:o,virtual:p}=ce("tree",e),[v,b]=De(c),r=g();s({treeRef:r,onNodeExpand:function(){var n;(n=r.value)===null||n===void 0||n.onNodeExpand(...arguments)},scrollTo:n=>{var k;(k=r.value)===null||k===void 0||k.scrollTo(n)},selectedKeys:T(()=>{var n;return(n=r.value)===null||n===void 0?void 0:n.selectedKeys}),checkedKeys:T(()=>{var n;return(n=r.value)===null||n===void 0?void 0:n.checkedKeys}),halfCheckedKeys:T(()=>{var n;return(n=r.value)===null||n===void 0?void 0:n.halfCheckedKeys}),loadedKeys:T(()=>{var n;return(n=r.value)===null||n===void 0?void 0:n.loadedKeys}),loadingKeys:T(()=>{var n;return(n=r.value)===null||n===void 0?void 0:n.loadingKeys}),expandedKeys:T(()=>{var n;return(n=r.value)===null||n===void 0?void 0:n.expandedKeys})}),Ke(()=>{we(e.replaceFields===void 0,"Tree","`replaceFields` is deprecated, please use fieldNames instead")});const A=(n,k)=>{l("update:checkedKeys",n),l("check",n,k)},_=(n,k)=>{l("update:expandedKeys",n),l("expand",n,k)},O=(n,k)=>{l("update:selectedKeys",n),l("select",n,k)};return()=>{const{showIcon:n,showLine:k,switcherIcon:M=m.switcherIcon,icon:u=m.icon,blockNode:a,checkable:y,selectable:h,fieldNames:K=e.replaceFields,motion:P=e.openAnimation,itemHeight:t=28,onDoubleclick:f,onDblclick:E}=e,W=N(N(N({},i),Ae(e,["onUpdate:checkedKeys","onUpdate:expandedKeys","onUpdate:selectedKeys","onDoubleclick"])),{showLine:!!k,dropIndicatorRender:st,fieldNames:K,icon:u,itemHeight:t}),S=m.default?Q(m.default()):void 0;return v(x(Oe,B(B({},W),{},{virtual:p.value,motion:P,ref:r,prefixCls:c.value,class:re({[`${c.value}-icon-hide`]:!n,[`${c.value}-block-node`]:a,[`${c.value}-unselectable`]:!h,[`${c.value}-rtl`]:o.value==="rtl"},i.class,b.value),direction:o.value,checkable:y,selectable:h,switcherIcon:j=>_e(c.value,M,j,m.leafIcon,k),onCheck:A,onExpand:_,onSelect:O,onDblclick:E||f,children:S}),N(N({},m),{checkable:()=>x("span",{class:`${c.value}-checkbox-inner`},null)})))}}});var $;(function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.End=2]="End"})($||($={}));function ne(e,d,i){function s(l){const m=l[d.key],c=l[d.children];i(m,l)!==!1&&ne(c||[],d,i)}e.forEach(s)}function ot(e){let{treeData:d,expandedKeys:i,startKey:s,endKey:l,fieldNames:m={title:"title",key:"key",children:"children"}}=e;const c=[];let o=$.None;if(s&&s===l)return[s];if(!s||!l)return[];function p(v){return v===s||v===l}return ne(d,m,v=>{if(o===$.End)return!1;if(p(v)){if(c.push(v),o===$.None)o=$.Start;else if(o===$.Start)return o=$.End,!1}else o===$.Start&&c.push(v);return i.includes(v)}),c}function J(e,d,i){const s=[...d],l=[];return ne(e,i,(m,c)=>{const o=s.indexOf(m);return o!==-1&&(l.push(c),s.splice(o,1)),!!s.length}),l}var dt=function(e,d){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&d.indexOf(s)<0&&(i[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,s=Object.getOwnPropertySymbols(e);l<s.length;l++)d.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(i[s[l]]=e[s[l]]);return i};const it=()=>N(N({},ve()),{expandAction:Y([Boolean,String])});function ct(e){const{isLeaf:d,expanded:i}=e;return d?x(Le,null,null):i?x(je,null,null):x(Re,null,null)}const q=te({compatConfig:{MODE:3},name:"ADirectoryTree",inheritAttrs:!1,props:fe(it(),{showIcon:!0,expandAction:"click"}),slots:Object,setup(e,d){let{attrs:i,slots:s,emit:l,expose:m}=d;var c;const o=g(e.treeData||se(Q((c=s.default)===null||c===void 0?void 0:c.call(s))));Z(()=>e.treeData,()=>{o.value=e.treeData}),be(()=>{ue(()=>{var t;e.treeData===void 0&&s.default&&(o.value=se(Q((t=s.default)===null||t===void 0?void 0:t.call(s))))})});const p=g(),v=g(),b=T(()=>$e(e.fieldNames)),r=g();m({scrollTo:t=>{var f;(f=r.value)===null||f===void 0||f.scrollTo(t)},selectedKeys:T(()=>{var t;return(t=r.value)===null||t===void 0?void 0:t.selectedKeys}),checkedKeys:T(()=>{var t;return(t=r.value)===null||t===void 0?void 0:t.checkedKeys}),halfCheckedKeys:T(()=>{var t;return(t=r.value)===null||t===void 0?void 0:t.halfCheckedKeys}),loadedKeys:T(()=>{var t;return(t=r.value)===null||t===void 0?void 0:t.loadedKeys}),loadingKeys:T(()=>{var t;return(t=r.value)===null||t===void 0?void 0:t.loadingKeys}),expandedKeys:T(()=>{var t;return(t=r.value)===null||t===void 0?void 0:t.expandedKeys})});const A=()=>{const{keyEntities:t}=Me(o.value,{fieldNames:b.value});let f;return e.defaultExpandAll?f=Object.keys(t):e.defaultExpandParent?f=Fe(e.expandedKeys||e.defaultExpandedKeys||[],t):f=e.expandedKeys||e.defaultExpandedKeys,f},_=g(e.selectedKeys||e.defaultSelectedKeys||[]),O=g(A());Z(()=>e.selectedKeys,()=>{e.selectedKeys!==void 0&&(_.value=e.selectedKeys)},{immediate:!0}),Z(()=>e.expandedKeys,()=>{e.expandedKeys!==void 0&&(O.value=e.expandedKeys)},{immediate:!0});const k=lt((t,f)=>{const{isLeaf:E}=f;E||t.shiftKey||t.metaKey||t.ctrlKey||r.value.onNodeExpand(t,f)},200,{leading:!0}),M=(t,f)=>{e.expandedKeys===void 0&&(O.value=t),l("update:expandedKeys",t),l("expand",t,f)},u=(t,f)=>{const{expandAction:E}=e;E==="click"&&k(t,f),l("click",t,f)},a=(t,f)=>{const{expandAction:E}=e;(E==="dblclick"||E==="doubleclick")&&k(t,f),l("doubleclick",t,f),l("dblclick",t,f)},y=(t,f)=>{const{multiple:E}=e,{node:W,nativeEvent:S}=f,j=W[b.value.key],V=N(N({},f),{selected:!0}),ye=(S==null?void 0:S.ctrlKey)||(S==null?void 0:S.metaKey),he=S==null?void 0:S.shiftKey;let I;E&&ye?(I=t,p.value=j,v.value=I,V.selectedNodes=J(o.value,I,b.value)):E&&he?(I=Array.from(new Set([...v.value||[],...ot({treeData:o.value,expandedKeys:O.value,startKey:j,endKey:p.value,fieldNames:b.value})])),V.selectedNodes=J(o.value,I,b.value)):(I=[j],p.value=j,v.value=I,V.selectedNodes=J(o.value,I,b.value)),l("update:selectedKeys",I),l("select",I,V),e.selectedKeys===void 0&&(_.value=I)},h=(t,f)=>{l("update:checkedKeys",t),l("check",t,f)},{prefixCls:K,direction:P}=ce("tree",e);return()=>{const t=re(`${K.value}-directory`,{[`${K.value}-directory-rtl`]:P.value==="rtl"},i.class),{icon:f=s.icon,blockNode:E=!0}=e,W=dt(e,["icon","blockNode"]);return x(X,B(B(B({},i),{},{icon:f||ct,ref:r,blockNode:E},W),{},{prefixCls:K.value,class:t,expandedKeys:O.value,selectedKeys:_.value,onSelect:y,onClick:u,onDblclick:a,onExpand:M,onCheck:h}),s)}}}),G=Ue,rt=N(X,{DirectoryTree:q,TreeNode:G,install:e=>(e.component(X.name,X),e.component(G.name,G),e.component(q.name,q),e)}),ut=te({__name:"auth-menu",setup(e,{expose:d}){const i=g(),s=g(!1),l=g([]);g();const m=g(),c=g([]),o=g([]),p=g([]),v=g([]),b=g([]),r=g([]),F=()=>{ke({role_id:i.value.id}).then(u=>{v.value=u.filter(a=>r.value.includes(a)),b.value=u})},A=u=>{let a=[];return u.forEach(y=>{a.push(y.id),y.children&&(a=a.concat(A(y.children)))}),a},_=u=>{const a=[],y=h=>{h.forEach(K=>{!K.children||K.children.length===0?a.push(K.id):y(K.children)})};y(u),r.value=a},[O,n]=Xe({onOpenChange(u){var a;i.value=u?(a=n.getData())==null?void 0:a.record:{},n.setState({loading:!0}),me({format:"tree"}).then(y=>{c.value=y!=null?y:[],o.value=A(y),_(y),l.value=o.value,ue(()=>{F()})}).finally(()=>{n.setState({loading:!1})})},onConfirm(){n.setState({loading:!0,confirmLoading:!0}),pe({role_id:i.value.id,menu_id:b.value}).then(()=>{ge.success("保存成功")}).finally(()=>{n.setState({loading:!1,confirmLoading:!1})})}}),k=(u,a)=>{s.value?(v.value=u.checked?u.checked:u,b.value=u.checked?u.checked:u):(v.value=u.checked?u.checked:u,b.value=[...u,...a.halfCheckedKeys])},M=({key:u})=>{const a={checkAll:()=>{v.value=o.value,b.value=o.value},cancelCheck:()=>{v.value=[],b.value=[]},openAll:()=>{l.value=o.value},closeAll:()=>{l.value=[]},noRelation:()=>{s.value=!1},isRelation:()=>{s.value=!0}};a[u]&&a[u]()};return d(n),(u,a)=>(Te(),Ee("div",null,[x(C(O),{class:"w-[40%]",title:"授权菜单",closable:!1},{title:w(()=>[x(C(Ce),{class:"left-close",onClick:a[0]||(a[0]=()=>{})}),a[12]||(a[12]=L(" 角色权限分配 ")),x(C(He),null,{overlay:w(()=>[x(C(Be),{onClick:a[1]||(a[1]=y=>M(y))},{default:w(()=>[x(C(U),{key:"checkAll"},{default:w(()=>a[4]||(a[4]=[L("选择全部")])),_:1}),x(C(U),{key:"cancelCheck"},{default:w(()=>a[5]||(a[5]=[L("取消选择")])),_:1}),a[10]||(a[10]=le("div",{class:"line"},null,-1)),x(C(U),{key:"openAll"},{default:w(()=>a[6]||(a[6]=[L("展开全部")])),_:1}),x(C(U),{key:"closeAll"},{default:w(()=>a[7]||(a[7]=[L("折叠全部")])),_:1}),a[11]||(a[11]=le("div",{class:"line"},null,-1)),x(C(U),{key:"noRelation",disabled:!s.value},{default:w(()=>a[8]||(a[8]=[L("层级关联")])),_:1},8,["disabled"]),x(C(U),{key:"isRelation",disabled:s.value},{default:w(()=>a[9]||(a[9]=[L("层级独立")])),_:1},8,["disabled"])]),_:1})]),default:w(()=>[x(C(We),{class:"right-more"})]),_:1})]),default:w(()=>[x(C(rt),{ref_key:"treeRef",ref:m,defaultExpandAll:"",checkable:"","check-strictly":s.value,"selected-keys":p.value,onCheck:k,checkedKeys:v.value,"onUpdate:checkedKeys":a[2]||(a[2]=y=>v.value=y),"expanded-keys":l.value,"onUpdate:expandedKeys":a[3]||(a[3]=y=>l.value=y),"click-row-to-expand":!1,"tree-data":c.value,"field-names":{title:"name",key:"value"}},null,8,["check-strictly","selected-keys","checkedKeys","expanded-keys","tree-data"])]),_:1})]))}}),bt=Ve(ut,[["__scopeId","data-v-212774a5"]]);export{bt as default};
